{% extends "default.html" %}

{% block title %}
<title>{{ u.name }}</title>
{% endblock %}

{% block adminpanel %}
{% if v.admin %}
{% if not u.banned %}
<form action="/api/banuser/{{ u.id }}" method="post">
<input type="submit" value="Ban User">
</form>
{% endif %}
{% if u.banned %}
<form action="/api/unbanuser/{{ u.id }}" method="post">
<input type="submit" value="Unban User">
</form>
{% endif %}
{% endif %}
{% endblock %}

{% block content %}
<h1>{{ u.name }}</h1>
{% if u.banned %} <p><span class="red"><b>[This user is banned.]</b></span></p>{% endif %}
{% if v.admin or v.id==u.id or not u.banned %}
<p>{% if u.admin %}<span class="red">[A]</span> {% endif %}User since: {{ u.created_date }}{% if v.id==u.id or u.patreon %} | {% endif %}{% if u.patreon %}<a href="https://patreon.com/{{ u.patreon }}">Patreon</a>{% elif v.id==u.id %}<a href="https://www.patreon.com/oauth2/authorize?client_id=Fy0C97RAlAGmKPtdxZT_Q4GiGoVks4zRqT9jrGmtf27Q02_UAUkTDZtOdZax8Scd&scope=users&state=x&response_type=code&redirect_uri=http://staging.captainslogbook.org/oauth/patreon">Connect Patreon</a>{% endif %}</p>
<hr>
<h2><b>Stories</b></h2>
{% for b in u.books() if ((v.admin or v.id==u.id) or (not b.banned and not b.deleted)) %}
<h3><a href="{{ b.url }}">{{ b.title }}</a></h3>
<ol>
{% for s in b.stories() | sort(attribute="id") %}
{% if (v.admin or v.id==u.id) or (not s.banned and not s.deleted) %}<li><a href="{{ s.url }}">{% if s.banned or s.deleted %}<s>{{ s.title }}</s>{% else %}{{ s.title }}{% endif %}</a></li>{% endif %}
{% endfor %}
</ol>
{% endfor %}
<h3>Standalone Stories</h3>
<ul>
{% for s in u.stories() if ((v.admin or v.id==u.id) or (not s.banned and not s.deleted)) and s.book_id==0 %}
<li><a href="{{ s.url }}">{% if s.banned or s.deleted %}<s>{{ s.title }}</s>{% else %}{{ s.title }}{% endif %}</a></li>
{% else %}
<li><em>None yet!</em></li>
{% endfor %}
</ul>
{% endif %}
{% endblock %}
